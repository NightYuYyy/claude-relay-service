# ç¼“å­˜æ¸…ç†è„šæœ¬ä½¿ç”¨è¯´æ˜

æœ¬ç›®å½•åŒ…å«ä¸¤ä¸ªç”¨äºæ¸…ç†æ•°æ®åº“ç¼“å­˜çš„è„šæœ¬ï¼Œä¿ç•™API Keyå’Œè´¦å·ä¿¡æ¯ä¸å˜ã€‚

## è„šæœ¬è¯´æ˜

### 1. å®Œæ•´ç‰ˆæ¸…ç†è„šæœ¬ (`clear-cache-data.js`)
- **åŠŸèƒ½**: å®‰å…¨æ¸…ç†æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼Œä¿ç•™é‡è¦é…ç½®
- **ç¡®è®¤æœºåˆ¶**: éœ€è¦ç”¨æˆ·è¾“å…¥ `YES` ç¡®è®¤æ‰§è¡Œ
- **è¯¦ç»†æ—¥å¿—**: æ˜¾ç¤ºè¯¦ç»†çš„æ¸…ç†è¿›åº¦å’Œç»Ÿè®¡ä¿¡æ¯
- **ä½¿ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒæˆ–é‡è¦æ•°æ®æ¸…ç†

### 2. å¿«é€Ÿæ¸…ç†è„šæœ¬ (`quick-clear-cache.js`)
- **åŠŸèƒ½**: å¿«é€Ÿæ¸…ç†å¸¸ç”¨ç¼“å­˜æ•°æ®
- **ç¡®è®¤æœºåˆ¶**: æ— éœ€ç¡®è®¤ï¼Œç›´æ¥æ‰§è¡Œ
- **ç®€åŒ–æ—¥å¿—**: ç®€æ´çš„æ‰§è¡Œæ—¥å¿—
- **ä½¿ç”¨åœºæ™¯**: å¼€å‘ç¯å¢ƒå¿«é€Ÿé‡ç½®

## è¿è¡Œæ–¹å¼

### ä½¿ç”¨ npm å‘½ä»¤ï¼ˆæ¨èï¼‰

```bash
# å®Œæ•´ç‰ˆæ¸…ç†ï¼ˆéœ€è¦ç¡®è®¤ï¼‰
npm run clear:cache

# å¿«é€Ÿæ¸…ç†ï¼ˆæ— éœ€ç¡®è®¤ï¼‰
npm run clear:cache:quick

# å¼ºåˆ¶å¿«é€Ÿæ¸…ç†ï¼ˆä¸ quick ç›¸åŒï¼‰
npm run clear:cache:force
```

### ç›´æ¥è¿è¡Œè„šæœ¬

```bash
# å®Œæ•´ç‰ˆæ¸…ç†
node scripts/clear-cache-data.js

# å¿«é€Ÿæ¸…ç†
node scripts/quick-clear-cache.js
```

## æ¸…ç†çš„æ•°æ®ç±»å‹

### âœ… ä¼šè¢«æ¸…é™¤çš„æ•°æ®
- **ä½¿ç”¨ç»Ÿè®¡**: `usage:*`, `account_usage:*`, `usage:platform:*`, `usage:model:*`
- **ä¼šè¯æ•°æ®**: `session:*`, `sticky_session:*`
- **é™æµçŠ¶æ€**: `rate_limit:*`
- **è°ƒåº¦å™¨çŠ¶æ€**: `scheduler:*`, `openai_scheduler:*`, `gemini_scheduler:*`
- **ç³»ç»Ÿç¼“å­˜**: `system_info`, `system_stats:*`, `metrics:*`
- **ä¸´æ—¶æ•°æ®**: `lock:*`, `temp:*`, `cache:*`
- **ç»Ÿè®¡ç¼“å­˜**: `daily_stats:*`, `monthly_stats:*`, `hourly_stats:*`

### ğŸ›¡ï¸ ä¿ç•™çš„æ•°æ®
- **API Keys**: `apikey:*`
- **Claude è´¦æˆ·**: `claude_account:*`
- **Gemini è´¦æˆ·**: `gemini_account:*`
- **OpenAI è´¦æˆ·**: `openai_account:*`
- **Azure OpenAI è´¦æˆ·**: `azure_openai_account:*`
- **Bedrock è´¦æˆ·**: `bedrock_account:*`
- **OpenAI-Responses è´¦æˆ·**: `openai_responses_account:*`
- **CCR è´¦æˆ·**: `ccr_account:*`
- **ç®¡ç†å‘˜ä¿¡æ¯**: `admin:*`, `admin_username:*`
- **ç”¨æˆ·ä¿¡æ¯**: `user:*`, `user_username:*`
- **è´¦æˆ·ç»„**: `account_group:*`

## ä½¿ç”¨å»ºè®®

### å¼€å‘ç¯å¢ƒ
```bash
# å¿«é€Ÿé‡ç½®ï¼Œç»§ç»­å¼€å‘
npm run clear:cache:quick
```

### æµ‹è¯•ç¯å¢ƒ
```bash
# å®‰å…¨æ¸…ç†ï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
npm run clear:cache
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# è°¨æ…ä½¿ç”¨ï¼Œå»ºè®®å…ˆå¤‡ä»½
npm run data:export:enhanced
npm run clear:cache
```

## æ¸…ç†åçš„å»ºè®®

1. **é‡å¯æœåŠ¡**: æ¸…ç†å®Œæˆåå»ºè®®é‡å¯æœåŠ¡ä»¥ç¡®ä¿ç¼“å­˜å®Œå…¨æ¸…ç©º
   ```bash
   npm run service:restart
   ```

2. **éªŒè¯åŠŸèƒ½**: æ£€æŸ¥å…³é”®åŠŸèƒ½æ˜¯å¦æ­£å¸¸
   - API Key è®¤è¯
   - è´¦æˆ·è°ƒåº¦
   - è´¹ç”¨ç»Ÿè®¡

3. **ç›‘æ§æ—¥å¿—**: è§‚å¯ŸæœåŠ¡å¯åŠ¨åçš„æ—¥å¿—
   ```bash
   npm run service:logs:follow
   ```

## æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æé†’**:
- æ¸…ç†æ“ä½œä¸å¯é€†ï¼Œè¯·ç¡®è®¤ä¸éœ€è¦å†å²ç»Ÿè®¡æ•°æ®
- æ¸…ç†åæ‰€æœ‰ä½¿ç”¨ç»Ÿè®¡å°†ä»0å¼€å§‹
- API Key é™é¢çŠ¶æ€ä¼šè¢«é‡ç½®
- è´¦æˆ·è°ƒåº¦çŠ¶æ€ä¼šè¢«é‡ç½®

ğŸ”’ **å®‰å…¨ä¿è¯**:
- ä¸ä¼šåˆ é™¤ä»»ä½•è´¦æˆ·é…ç½®
- ä¸ä¼šåˆ é™¤API Keyé…ç½®
- ä¸ä¼šåˆ é™¤ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯
- ä¸ä¼šå½±å“è´¦æˆ·ç»‘å®šå…³ç³»

## æ•…éšœæ’é™¤

å¦‚æœè„šæœ¬æ‰§è¡Œå¤±è´¥ï¼š

1. **æ£€æŸ¥ Redis è¿æ¥**
   ```bash
   # æ£€æŸ¥ Redis æœåŠ¡çŠ¶æ€
   redis-cli ping
   ```

2. **æ£€æŸ¥æƒé™**
   ```bash
   # ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
   chmod +x scripts/*.js
   ```

3. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯**
   - æ£€æŸ¥ `logs/claude-relay-*.log` æ–‡ä»¶
   - è¿è¡Œ `npm run service:status` æ£€æŸ¥æœåŠ¡çŠ¶æ€